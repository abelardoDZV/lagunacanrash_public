<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carta - Laguna Canrash</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2d4f3c',
                        secondary: '#c8a97e',
                        accent: '#f1ece3',
                        text: '#333',
                        background: '#f9f7f4',
                        border: '#e0d7c7',
                    },
                    fontFamily: {
                        'playfair': ['"Playfair Display"', 'serif'],
                        'poppins': ['Poppins', 'sans-serif'],
                    },
                    fontSize: {
                        '2xs': '0.65rem',
                        '3xs': '0.55rem',
                    }
                }
            }
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Poppins:wght@300;400;500;600&display=swap"
        rel="stylesheet">
</head>

<body class="bg-background text-text min-h-screen bg-gradient-to-br from-accent/40 to-white/80 font-poppins">
    {% if current_user.is_authenticated %}
    <div class="fixed top-3 right-3 sm:top-5 sm:right-5 z-50 flex gap-1 sm:gap-2">
        <a href="{{ url_for('main.menu') }}"
            class="flex items-center gap-1 sm:gap-2 bg-secondary hover:bg-secondary/90 text-white py-1 px-2.5 sm:py-2 sm:px-4 rounded-full text-xs sm:text-sm font-poppins transition-all duration-300 shadow-md hover:shadow-lg hover:-translate-y-0.5">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 sm:w-4 sm:h-4" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
            </svg>
            Inicio
        </a>
        {% if current_user.role == 'admin' %}
        <a href="{{ url_for('carta.editar_carta') }}"
            class="flex items-center gap-1 sm:gap-2 bg-primary hover:bg-primary/90 text-white py-1 px-2.5 sm:py-2 sm:px-4 rounded-full text-xs sm:text-sm font-poppins transition-all duration-300 shadow-md hover:shadow-lg hover:-translate-y-0.5">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 sm:w-4 sm:h-4" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
            </svg>
            Editar Carta
        </a>
        {% endif %}
    </div>
    {% endif %}

    <div
        class="max-w-3xl mx-auto my-1 sm:my-6 p-2 sm:p-6 bg-white rounded-md sm:rounded-2xl shadow-lg border border-border relative overflow-hidden">
        <!-- Decorative header bar -->
        <div class="absolute top-0 left-0 right-0 h-0.5 sm:h-1 bg-gradient-to-r from-secondary to-primary"></div>

        <!-- Header Section -->
        <header class="text-center mb-1 sm:mb-4">
            <div class="flex justify-center mb-1 sm:mb-2">
                <!-- <img src="{{ url_for('static', filename='img/thumbs/logo_laguna.jpg') }}" alt="Logo Laguna Canrash"
                    class="w-6 h-6 sm:w-16 sm:h-16 rounded-full border-0 sm:border sm:border-white shadow-sm sm:shadow-md mx-1 sm:mx-2 object-cover"
                    onerror="this.style.display='none'">
                <img src="{{ url_for('static', filename='img/thumbs/logo_laguna.jpg') }}" alt="Logo Laguna Canrash"
                    class="w-8 h-8 sm:w-20 sm:h-20 rounded-full border-0 sm:border sm:border-white shadow-sm sm:shadow-md mx-1 sm:mx-2 object-cover"
                    onerror="this.style.display='none'"> -->
            </div>

            <h2 class="font-playfair text-xl sm:text-4xl font-bold text-primary relative inline-block mb-0">
                Laguna Canrash
            </h2>

            <h1
                class="font-poppins text-2xs sm:text-lg uppercase tracking-wider text-primary font-medium opacity-90 mb-0.5 sm:mb-1">
                Nuestra Carta
            </h1>

            <div class="h-0.5 w-8 sm:w-20 mx-auto bg-gradient-to-r from-secondary to-primary rounded-full my-1 sm:my-3">
            </div>
        </header>

        <!-- Notes Section -->
        <div class="text-center mb-1 sm:mb-2">
            <!-- Disclamer Section -->
            <div class="flex flex-col items-center">
                <p
                    class="italic text-3xs sm:text-xs text-gray-600 bg-accent/50 px-1.5 py-0 sm:px-3 sm:py-1 rounded inline-block shadow-sm">
                    *Algunos platos aplican: anticipación 2 días y mínimo personas
                </p>
            </div>

            <!-- Contact Info -->
            <div class="mt-1 mb-0.5">
                <div class="flex justify-center items-center flex-wrap gap-1 sm:gap-2">
                    <!-- WhatsApp -->
                    <button onclick="copyToClipboard('957 878 409', 'whatsapp-tooltip')"
                        class="flex items-center gap-0.5 sm:gap-1.5 bg-green-50 hover:bg-green-100 text-green-600 px-2 py-0.5 sm:py-1.5 sm:px-3 rounded-full text-xs sm:text-sm transition-all group relative">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 sm:w-4 sm:h-4 text-green-600"
                            fill="currentColor" viewBox="0 0 24 24">
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M18.403 5.633A8.919 8.919 0 0 0 12.053 3c-4.948 0-8.976 4.027-8.978 8.977 0 1.582.413 3.126 1.198 4.488L3 21.116l4.759-1.249a8.981 8.981 0 0 0 4.29 1.093h.004c4.947 0 8.975-4.027 8.977-8.977a8.926 8.926 0 0 0-2.627-6.35m-6.35 13.812h-.003a7.446 7.446 0 0 1-3.798-1.041l-.272-.162-2.824.741.753-2.753-.177-.282a7.448 7.448 0 0 1-1.141-3.971c.002-4.114 3.349-7.461 7.465-7.461a7.413 7.413 0 0 1 5.275 2.188 7.42 7.42 0 0 1 2.183 5.279c-.002 4.114-3.349 7.462-7.461 7.462m4.093-5.589c-.225-.113-1.327-.655-1.533-.73-.205-.075-.354-.112-.504.112s-.58.729-.711.879-.262.168-.486.056-.947-.349-1.804-1.113c-.667-.595-1.117-1.329-1.248-1.554s-.014-.346.099-.458c.101-.1.224-.262.336-.393.112-.131.149-.224.224-.374s.038-.281-.019-.393c-.056-.113-.505-1.217-.692-1.666-.181-.435-.366-.375-.504-.383a9.65 9.65 0 0 0-.429-.008.826.826 0 0 0-.599.28c-.206.225-.785.767-.785 1.871s.804 2.171.916 2.321c.112.15 1.582 2.415 3.832 3.387.536.231.954.369 1.279.473.537.171 1.026.146 1.413.089.431-.064 1.327-.542 1.514-1.066.187-.524.187-.973.131-1.067-.056-.094-.207-.151-.43-.263" />
                        </svg>
                        <span class="font-medium text-xs sm:text-sm">957 878 409</span>
                        <span id="whatsapp-tooltip"
                            class="absolute -top-5 sm:-top-7 left-1/2 -translate-x-1/2 bg-green-100 text-green-700 px-1 py-0.5 sm:px-2 sm:py-1 rounded text-2xs sm:text-xs whitespace-nowrap opacity-0 transition-opacity duration-300">¡Copiado!</span>
                    </button>

                    <!-- Social Media -->
                    <div class="flex items-center gap-1 sm:gap-3">
                        <a href="https://www.facebook.com/LagunaCanrashPeru/" target="_blank" rel="noopener noreferrer"
                            class="bg-blue-50 hover:bg-blue-100 text-blue-600 p-1 sm:p-2 rounded-full transition-transform">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 sm:w-4 sm:h-4" viewBox="0 0 24 24"
                                fill="currentColor">
                                <path
                                    d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-2c-.55 0-1 .45-1 1v2h3v3h-3v6.95c5.05-.5 9-4.76 9-9.95z" />
                            </svg>
                        </a>
                        <a href="https://www.instagram.com/lagunacanrash/" target="_blank" rel="noopener noreferrer"
                            class="bg-pink-50 hover:bg-pink-100 text-pink-600 p-1 sm:p-2 rounded-full transition-transform">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 sm:w-4 sm:h-4" viewBox="0 0 24 24"
                                fill="currentColor">
                                <path
                                    d="M12 2c2.717 0 3.056.01 4.122.06 1.065.05 1.79.217 2.428.465.66.254 1.216.598 1.772 1.153.509.5.902 1.105 1.153 1.772.247.637.415 1.363.465 2.428.047 1.066.06 1.405.06 4.122 0 2.717-.01 3.056-.06 4.122-.05 1.065-.218 1.79-.465 2.428a4.883 4.883 0 01-1.153 1.772c-.5.508-1.105.902-1.772 1.153-.637.247-1.363.415-2.428.465-1.066.047-1.405.06-4.122.06-2.717 0-3.056-.01-4.122-.06-1.065-.05-1.79-.218-2.428-.465a4.89 4.89 0 01-1.772-1.153 4.904 4.904 0 01-1.153-1.772c-.247-.637-.415-1.363-.465-2.428C2.013 15.056 2 14.717 2 12c0-2.717.01-3.056.06-4.122.05-1.066.218-1.79.465-2.428.247-.669.642-1.275 1.153-1.772a4.904 4.904 0 011.772-1.153c.637-.247 1.362-.415 2.428-.465C8.944 2.013 9.283 2 12 2zm0 1.802c-2.67 0-2.986.01-4.04.06-.976.045-1.505.207-1.858.344-.466.181-.8.398-1.15.748-.35.35-.566.683-.748 1.15-.137.353-.3.882-.344 1.857-.05 1.055-.06 1.37-.06 4.041 0 2.67.01 2.986.06 4.04.045.976.207 1.505.344 1.858.181.466.399.8.748 1.15.35.35.683.566 1.15.748.353.137.882.3 1.857.344 1.054.05 1.37.06 4.041.06 2.67 0 2.987-.01 4.04-.06.976-.045 1.505-.207 1.858-.344.466-.181.8-.398 1.15-.748.35-.35.566-.683.748-1.15.137-.353.3-.882.344-1.857.05-1.055.06-1.37.06-4.041 0-2.67-.01-2.986-.06-4.04-.045-.976-.207-1.505-.344-1.858a3.097 3.097 0 00-.748-1.15 3.098 3.098 0 00-1.15-.748c-.353-.137-.882-.3-1.857-.344-1.055-.05-1.37-.06-4.041-.06zm0 3.064A5.139 5.139 0 0017.134 12 5.139 5.139 0 0012 17.134 5.139 5.139 0 006.866 12 5.139 5.139 0 0012 6.866zM12 15.338a3.333 3.333 0 010-6.667 3.333 3.333 0 010 6.667zm6.538-8.671a1.2 1.2 0 11-2.4 0 1.2 1.2 0 012.4 0z" />
                            </svg>
                        </a>
                    </div>
                </div>
            </div>


        </div>

        <!-- Menu Sections -->
        <!-- Trucha Section -->
        <section
            class="mb-1.5 sm:mb-2 bg-white/80 rounded-md sm:rounded-lg p-1.5 sm:p-2 shadow-sm hover:shadow-md transition-all duration-300 hover:-translate-y-0.5">
            <h3
                class="font-playfair font-bold text-2xs sm:text-lg text-primary text-center uppercase relative inline-block left-1/2 transform -translate-x-1/2 mb-0.5 sm:mb-1 px-2 sm:px-3 pb-0.5">
                A BASE DE TRUCHA
                <span
                    class="absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r from-transparent via-secondary to-transparent"></span>
            </h3>

            <ul class="space-y-0 sm:space-y-0.5">
                {% for item in trucha_items %}
                <li
                    class="flex justify-between items-center py-0.5 border-b border-dashed border-secondary/20 hover:bg-accent/30 px-1 rounded transition-colors">
                    <span class="font-poppins text-primary font-medium text-2xs sm:text-sm">{{ item.producto.nombre
                        }}</span>
                    <span
                        class="font-poppins text-secondary font-semibold bg-secondary/10 py-0 sm:py-0.5 px-1 sm:px-1.5 text-2xs sm:text-sm rounded-full">S/.
                        {{ "%.2f"|format(item.precio) }}</span>
                </li>
                {% endfor %}
            </ul>
        </section>

        <!-- Pollo Section -->
        <section
            class="mb-1.5 sm:mb-2 bg-white/80 rounded-md sm:rounded-lg p-1.5 sm:p-2 shadow-sm hover:shadow-md transition-all duration-300 hover:-translate-y-0.5">
            <h3
                class="font-playfair font-bold text-2xs sm:text-lg text-primary text-center uppercase relative inline-block left-1/2 transform -translate-x-1/2 mb-0.5 sm:mb-1 px-2 sm:px-3 pb-0.5">
                A BASE DE POLLO
                <span
                    class="absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r from-transparent via-secondary to-transparent"></span>
            </h3>

            <ul class="space-y-0 sm:space-y-0.5">
                {% for item in pollo_items %}
                <li
                    class="flex justify-between items-center py-0.5 border-b border-dashed border-secondary/20 hover:bg-accent/30 px-1 rounded transition-colors">
                    <span class="font-poppins text-primary font-medium text-2xs sm:text-sm">{{ item.producto.nombre
                        }}</span>
                    <span
                        class="font-poppins text-secondary font-semibold bg-secondary/10 py-0 sm:py-0.5 px-1 sm:px-1.5 text-2xs sm:text-sm rounded-full">S/.
                        {{ "%.2f"|format(item.precio) }}</span>
                </li>
                {% endfor %}
            </ul>
        </section>

        <!-- Otros Section -->
        <section
            class="mb-1.5 sm:mb-2 bg-white/80 rounded-md sm:rounded-lg p-1.5 sm:p-2 shadow-sm hover:shadow-md transition-all duration-300 hover:-translate-y-0.5">
            <h3
                class="font-playfair font-bold text-2xs sm:text-lg text-primary text-center uppercase relative inline-block left-1/2 transform -translate-x-1/2 mb-0.5 sm:mb-1 px-2 sm:px-3 pb-0.5">
                OTROS PLATOS
                <span
                    class="absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r from-transparent via-secondary to-transparent"></span>
            </h3>

            <ul class="space-y-0 sm:space-y-0.5">
                {% for item in otros_items %}
                <li
                    class="flex justify-between items-center py-0.5 border-b border-dashed border-secondary/20 hover:bg-accent/30 px-1 rounded transition-colors">
                    <span class="font-poppins text-primary font-medium text-2xs sm:text-sm">{{ item.producto.nombre
                        }}</span>
                    <span
                        class="font-poppins text-secondary font-semibold bg-secondary/10 py-0 sm:py-0.5 px-1 sm:px-1.5 text-2xs sm:text-sm rounded-full">S/.
                        {{ "%.2f"|format(item.precio) }}</span>
                </li>
                {% endfor %}
            </ul>
        </section>
        <!-- Payment Info -->
        <div class="mt-1 sm:mt-2 bg-accent rounded-md sm:rounded-lg p-1 sm:p-2 shadow-sm relative overflow-hidden">
            <div
                class="absolute top-0 left-0 right-0 h-0.5 bg-gradient-to-r from-transparent via-secondary to-transparent">
            </div>

            <h4 class="text-primary font-playfair font-semibold text-2xs sm:text-base mb-0.5 sm:mb-1">Formas de Pago -
                para reservas o llevar:
            </h4>

            <div class="grid grid-cols-1 gap-0.5 sm:gap-1">
                <!-- Yape -->
                <div class="bg-white/60 rounded p-1 sm:p-1.5 shadow-sm hover:shadow transition-all">
                    <h5 class="text-purple-800 font-medium text-2xs sm:text-xs mb-0">Yape</h5>
                    <div class="flex items-center justify-center gap-0.5">
                        <button onclick="copyToClipboard('957 878 409', 'yape-tooltip')"
                            class="bg-purple-50 text-2xs sm:text-xs py-0 sm:py-0.5 px-1 sm:px-1.5 rounded-full text-purple-800 hover:bg-purple-100 transition-colors flex items-center gap-0.5 sm:gap-1 relative">
                            <span>957 878 409</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-2 h-2 sm:w-3 sm:h-3" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                            <span id="yape-tooltip"
                                class="absolute -top-4 sm:-top-7 left-1/2 -translate-x-1/2 bg-green-100 text-green-700 px-0.5 sm:px-2 py-0 sm:py-1 rounded text-2xs sm:text-xs whitespace-nowrap opacity-0 transition-opacity duration-300">¡Copiado!</span>
                        </button>
                    </div>
                    <p class="text-2xs sm:text-xs italic mt-0 sm:mt-0.5 text-gray-600 text-center">"Empresa Isla de
                        Canrash SRL"</p>
                </div>
            </div>
        </div>
        <!-- Footer -->
        <footer
            class="text-center mt-1 sm:mt-2 pt-0.5 sm:pt-1 border-t border-border text-gray-500 text-2xs sm:text-xs relative">
            <div
                class="absolute top-0 left-1/2 transform -translate-x-1/2 w-6 sm:w-12 h-0.5 bg-gradient-to-r from-transparent via-secondary to-transparent">
            </div>
            <p>© {{ now.year }} Laguna Canrash</p>
        </footer>
    </div>

    <!-- Botón para copiar como imagen -->
    <div class="fixed bottom-3 right-3 sm:bottom-5 sm:right-5 z-50">
        <button id="copyImageBtn"
            class="flex items-center gap-1 sm:gap-2 bg-primary hover:bg-primary/90 text-white py-1 px-2.5 sm:py-2 sm:px-4 rounded-full text-xs sm:text-sm font-poppins transition-all duration-300 shadow-md hover:shadow-lg hover:-translate-y-0.5">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 sm:w-4 sm:h-4 icon-copy" fill="none"
                viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 sm:w-4 sm:h-4 icon-success hidden" fill="none"
                viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            <span id="copyBtnText">Copiar Carta</span>
        </button>
        <div id="statusMessage"
            class="mt-1 sm:mt-2 text-xs sm:text-sm font-medium hidden absolute right-0 w-36 sm:w-48 bg-white p-1.5 sm:p-2 rounded-lg shadow-lg text-center">
        </div>
    </div>

    <!-- html2canvas Script -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
        function copyToClipboard(text, tooltipId) {
            // Create temporary input element
            const tempInput = document.createElement('input');
            tempInput.value = text;
            document.body.appendChild(tempInput);

            // Select the text
            tempInput.select();
            tempInput.setSelectionRange(0, 99999); // For mobile devices

            // Copy the text
            document.execCommand('copy');

            // Remove the temporary element
            document.body.removeChild(tempInput);

            // Show tooltip
            const tooltip = document.getElementById(tooltipId);
            tooltip.classList.add('opacity-100');

            setTimeout(() => {
                tooltip.classList.remove('opacity-100');
            }, 2000);
        }

        // Función para copiar la carta como imagen
        document.getElementById('copyImageBtn').addEventListener('click', function () {
            const statusMessage = document.getElementById('statusMessage');
            const element = document.querySelector('.max-w-3xl'); // El contenedor de la carta
            const copyBtn = document.getElementById('copyImageBtn');
            const copyBtnText = document.getElementById('copyBtnText');
            const iconCopy = document.querySelector('.icon-copy');
            const iconSuccess = document.querySelector('.icon-success');

            // Deshabilitar botón durante el proceso
            copyBtn.disabled = true;

            // Mostrar mensaje de carga
            statusMessage.textContent = "Generando imagen...";
            statusMessage.classList.remove('hidden', 'text-red-600', 'text-green-600');
            statusMessage.classList.add('text-white', 'bg-primary');

            html2canvas(element, {
                scale: 2, // Mejor resolución
                backgroundColor: "#ffffff",
                logging: false,
                useCORS: true,
            }).then(canvas => {
                // Convertir canvas a blob
                canvas.toBlob(function (blob) {
                    try {
                        // Crear un ClipboardItem y escribir al portapapeles
                        const item = new ClipboardItem({ "image/png": blob });
                        navigator.clipboard.write([item]).then(
                            function () {
                                // Cambiar el aspecto del botón para indicar éxito
                                copyBtn.classList.remove('bg-primary');
                                copyBtn.classList.add('bg-green-600');
                                copyBtnText.textContent = "¡Copiado!";
                                iconCopy.classList.add('hidden');
                                iconSuccess.classList.remove('hidden');

                                // Mostrar mensaje de éxito
                                statusMessage.textContent = "¡Carta copiada al portapapeles!";
                                statusMessage.classList.remove('hidden', 'bg-primary');
                                statusMessage.classList.add('bg-green-100', 'text-green-700');

                                // Restaurar el botón después de 3 segundos
                                setTimeout(() => {
                                    copyBtn.classList.remove('bg-green-600');
                                    copyBtn.classList.add('bg-primary');
                                    copyBtnText.textContent = "Copiar Carta";
                                    iconCopy.classList.remove('hidden');
                                    iconSuccess.classList.add('hidden');
                                    statusMessage.classList.add('hidden');
                                    copyBtn.disabled = false;
                                }, 3000);
                            },
                            function (error) {
                                // Fallback para navegadores antiguos o problemas de permisos
                                statusMessage.textContent = "No se pudo copiar directamente. Se descargará la imagen.";
                                statusMessage.classList.remove('hidden', 'bg-primary');
                                statusMessage.classList.add('bg-red-100', 'text-red-700');

                                // Restaurar el botón
                                copyBtn.disabled = false;

                                // Crear un enlace temporal para descargar la imagen
                                const link = document.createElement('a');
                                link.download = 'carta-laguna-canrash.png';
                                link.href = canvas.toDataURL('image/png');
                                document.body.appendChild(link);
                                link.click();
                                document.body.removeChild(link);

                                // Ocultar el mensaje después de 5 segundos
                                setTimeout(() => {
                                    statusMessage.classList.add('hidden');
                                }, 5000);

                                console.error("Error copiando al portapapeles:", error);
                            }
                        );
                    } catch (err) {
                        // Restaurar el botón
                        copyBtn.disabled = false;

                        // Fallback para navegadores que no soportan ClipboardItem
                        const url = canvas.toDataURL('image/png');
                        const img = new Image();
                        img.src = url;

                        // Mostrar la imagen en un modal
                        const modal = document.createElement('div');
                        modal.style.position = 'fixed';
                        modal.style.top = '0';
                        modal.style.left = '0';
                        modal.style.width = '100%';
                        modal.style.height = '100%';
                        modal.style.backgroundColor = 'rgba(0,0,0,0.8)';
                        modal.style.display = 'flex';
                        modal.style.justifyContent = 'center';
                        modal.style.alignItems = 'center';
                        modal.style.zIndex = '9999';
                        modal.style.flexDirection = 'column';
                        modal.style.padding = '20px';
                        modal.style.boxSizing = 'border-box';
                        modal.style.overflow = 'auto';

                        img.style.maxWidth = '100%';
                        img.style.maxHeight = '80%';
                        img.style.objectFit = 'contain';

                        const instructions = document.createElement('p');
                        instructions.textContent = 'Haga clic derecho en la imagen y seleccione "Copiar imagen" o "Guardar imagen como..."';
                        instructions.style.color = 'white';
                        instructions.style.marginTop = '20px';

                        const closeButton = document.createElement('button');
                        closeButton.textContent = 'Cerrar';
                        closeButton.style.marginTop = '20px';
                        closeButton.style.padding = '8px 16px';
                        closeButton.style.backgroundColor = '#2d4f3c';
                        closeButton.style.color = 'white';
                        closeButton.style.border = 'none';
                        closeButton.style.borderRadius = '4px';
                        closeButton.style.cursor = 'pointer';

                        closeButton.onclick = function () {
                            document.body.removeChild(modal);
                        };

                        modal.appendChild(img);
                        modal.appendChild(instructions);
                        modal.appendChild(closeButton);
                        document.body.appendChild(modal);

                        statusMessage.textContent = "Use el botón derecho para copiar la imagen mostrada.";
                        statusMessage.classList.remove('hidden', 'bg-primary');
                        statusMessage.classList.add('bg-red-100', 'text-red-700');

                        console.error("El navegador no soporta ClipboardItem:", err);
                    }
                });
            }).catch(err => {
                statusMessage.textContent = "Error al generar la imagen: " + err.message;
                statusMessage.classList.remove('hidden', 'bg-primary');
                statusMessage.classList.add('bg-red-100', 'text-red-700');

                // Restaurar el botón
                copyBtn.disabled = false;

                // Ocultar el mensaje después de 5 segundos
                setTimeout(() => {
                    statusMessage.classList.add('hidden');
                }, 5000);

                console.error("Error generando imagen:", err);
            });
        });
    </script>
</body>

</html>